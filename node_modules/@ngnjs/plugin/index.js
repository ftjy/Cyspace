// @ngnjs/plugin v1.0.0-alpha.10
// Copyright (c) 2022 Corey Butler
// Released under the MIT License.
const PATTERN=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;class Version{constructor(version){const parts=PATTERN.exec(version);if(!parts)throw new Error("Invalid semantic version.");this.major=parseInt(parts[1],10),this.minor=parseInt(parts[2],10),this.patch=parseInt(parts[3],10),this.prerelease=parts[4],this.build=parts[5]}toString(){return`${this.major}.${this.minor}.${this.patch}${this.prerelease?"-"+this.prerelease:""}`}get name(){const match=/^(a-zA-Z0-9-_)[\.|\+]?/i.exec(this.prerelease);return match?match[1].trim():null}get subversion(){return null===this.name?0:this.prerelease.replace(this.name,"").trim()}}function normalize(a,b){return{a:"string"==typeof a?new Version(a):a,b:"string"==typeof b?new Version(b):b}}class SV{static parse(version){return new Version(version)}static gt(){const{a:a,b:b}=normalize(...arguments);if(a.major<b.major)return!1;if(a.minor<b.minor)return!1;if(a.patch<b.patch)return!1;if(null===a.name&&null!==b.name)return!0;if(null!==a.name&&null===b.name)return!1;if(a.name!==b.name&&null!==a.name)return a.name>b.name;if(!isNaN(a.subversion)&&isNaN(b.subversion))return!0;if(isNaN(a.subversion)&&!isNaN(b.subversion))return!1;if(typeof a.subversion==typeof b.subversion&&"string"==typeof a.subversion)return a.subversion.length>b.subversions.length;if(!a.prerelease&&b.prerelease)return!0;if(a.prerelease&&!b.prerelease)return!1;if(a.prerelease&&b.prerelease)try{const{aPrefix:aPrefix}=/^(<aPrefix>[^\d]+)/i.exec(a.prerelease).groups,{bPrefix:bPrefix}=/^(<bPrefix>[^\d]+)/i.exec(b.prerelease).groups;if(aPrefix!==bPrefix)return aPrefix>bPrefix;const{aNum:aNum}=/(<aNum>^\d+)/i.exec(a.prerelease).groups,{bNum:bNum}=/(<bNum>^\d+)/i.exec(b.prerelease).groups;return void 0!==aNum&&(void 0===bNum||aNum!==bNum&&aNum>bNum)}catch(e){return a.prerelease>b.prerelease}return!0}static gte(){return SV.eq(...arguments)||SV.gt(...arguments)}static lt(){return!SV.gte(...arguments)}static lte(){return SV.eq(...arguments)||SV.lt(...arguments)}static eq(){const{a:a,b:b}=normalize(...arguments);return a.toString()===b.toString()}static sort(){return Array.from(new Set(Array.from(arguments).map(v=>v instanceof Version?v:new Version(v)).sort((a,b)=>SV.gt(a,b)?-1:SV.lt(a,b)?1:0)))}static select(pattern){if(arguments.length<2)return null;const list=SV.sort(...Array.from(arguments).slice(1)),match=/^(\^|~|<=?|>=?)(.*)/i.exec(pattern||"");let version=match?match[2]:pattern;if(!match){const i=list.map(i=>i.toString()).indexOf(version);return i>=0?list[i].toString():null}return version=new Version(version),list.filter(i=>{switch(match[1]){case">":return SV.gt(i,version);case">=":return SV.gte(i,version);case"<":return SV.lt(i,version);case"<=":return SV.lte(i,version);case"^":return SV.gte(i,version)&&i.major===version.major;case"~":return SV.gte(i,version)&&i.major===version.major&&i.minor===version.minor}}).shift().toString()}}const ID=Symbol.for("NGN"),priv=(value,writable=!1)=>({enumerable:!1,configurable:!1,writable:writable,value:value}),moduleVersion="1.0.0-alpha.10";export default class Reference{constructor(version=null){Object.defineProperties(this,{instance:priv(reference=>globalThis[reference]&&(reference=globalThis[reference])instanceof Map&&reference.has("INSTANCE")?reference.get("INSTANCE"):null),base:priv({},!0),ref:priv(null,!0),proxy:priv(null,!0)}),this.use(version);const me=this;return this.proxy=new Proxy(this.base,{get(target,property){if(void 0!==target[property])return target[property];if(me.ref){const plugins=globalThis[me.ref].get("PLUGINS")||new Map;if(plugins.has(property))return plugins.get(property)}return me[property]},set(target,property,value){if(null===me.ref)throw new Error("Cannot find NGN.");const plugins=globalThis[me.ref].get("plugins")||new Map;return plugins.set(property,value),globalThis[me.ref].set("PLUGINS",plugins),!0}}),Object.freeze(this.proxy),this.proxy}get availableVersions(){let options=globalThis[ID]||[];return 0===options.length&&(options=Object.getOwnPropertySymbols(globalThis).filter(s=>globalThis[s]instanceof Map&&globalThis[s].has("REFERENCE_ID")&&globalThis[s].get("REFERENCE_ID")===s)),options.sort((a,b)=>SV.gte(globalThis[a].get("VERSION"),globalThis[b].get("VERSION"))?-1:1)}export(name){const plugins=globalThis[this.ref].get("plugins")||new Map,elements=new Set(Array.from(arguments).slice(1));if(0===elements.size)throw new Error("Missing arguments. Nothing was specified to export.");plugins.set(name,Array.from(elements)),globalThis[this.ref].set("PLUGINS",plugins)}use(version=null){let options=this.availableVersions;return version&&(version=SV.select(version,...options.map(id=>globalThis[id].get("VERSION"))),options=options.filter(id=>globalThis[id]instanceof Map&&version===globalThis[id].get("VERSION"))),0===options.length?null:(this.ref=options.shift(),this.base=this.instance(this.ref),this.proxy)}requires(){if(arguments.length>0){if(null===this.base)throw new Error("NGN is required.");const missing=new Set;for(const el of arguments)if(el.indexOf(":")>0||!this.exist(el)){const match=/(?<feature>[^:\n]+):?(?<version>\d+\.\d+\.\d+([-+].+)?)?/i.exec(el);if(match){const{feature:feature,version:version}=match.groups;if(this.base.plugins[feature])try{const pv="function"==typeof this.base.plugins[feature].version?typeof this.base.plugins[feature].version():typeof this.base.plugins[feature].version;SV.select(version,pv)!==pv&&missing.add(feature+"@"+version)}catch(e){missing.add(feature+"@"+version)}else missing.add(feature)}}if(missing.size>0){const msg=`The following NGN elements are required but not present in the environment: ${Array.from(missing).join(", ")}. Make sure these have been imported.`;throw new Error(msg)}}return this.proxy}exist(){for(const component of arguments){let Element=component.split(".").reduceRight((acc,el)=>void 0===acc[el]?acc=acc[el]:acc[el],this.base);if(void 0===Element){if(Element=globalThis[component],void 0===Element)return!1;if("function"==typeof Element)try{if(!(new Element instanceof Error))return!1}catch(e){return!1}}}return!0}}export{SV as Semver,moduleVersion};
//# sourceMappingURL=../plugin-debug/index.js.map
